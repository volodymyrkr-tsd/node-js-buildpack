#!/usr/bin/env bash
set -e

echo "ðŸ—ï¸ [TSD CNB] Build phase started"
echo "ðŸ“¦ Installing dependencies and configuring Node.js manually (placeholder)"

# ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸
LAYERS_DIR=$1
PLATFORM_DIR=$2
PLAN_PATH=$3

# Ð¨Ð»ÑÑ… Ð´Ð¾ ÑˆÐ°Ñ€Ñƒ
APP_LAYER_DIR="${LAYERS_DIR}/tsd-layer"

# 1. Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ ÑˆÐ°Ñ€Ñƒ
mkdir -p "${APP_LAYER_DIR}"

# 2. ÐšÐ¾Ð¿Ñ–ÑŽÑ”Ð¼Ð¾ ÐºÐ¾Ð´ Ð´Ð¾Ð´Ð°Ñ‚ÐºÑƒ
cp -r ./* "${APP_LAYER_DIR}/"

# 3. Ð¡Ñ‚Ð²Ð¾Ñ€ÑŽÑ”Ð¼Ð¾ Ð¼ÐµÑ‚Ð°-Ñ„Ð°Ð¹Ð» ÑˆÐ°Ñ€Ñƒ
cat > "${LAYERS_DIR}/tsd-layer.toml" <<EOF
[types]
  launch = true
  build = true
  cache = false
EOF

# 4. Ð¡Ñ‚Ð²Ð¾Ñ€ÑŽÑ”Ð¼Ð¾ launch.toml
cat > "${LAYERS_DIR}/launch.toml" <<EOF
[[processes]]
type = "web"
command = "node"
args = ["app.js"]
default = true
EOF

echo "âœ… [TSD CNB] Build phase finished"
